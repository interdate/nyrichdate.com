/*
    A simple jQuery kfModal (http://github.com/kylefox/jquery-kfModal)
    Version 0.6.0
*/
!function(o){var t=null;o.kfModal=function(e,i){o.kfModal.close();var s,l;if(this.$body=o("body"),this.options=o.extend({},o.kfModal.defaults,i),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),e.is("a"))if(l=e.attr("href"),/^#/.test(l)){if(this.$elm=o(l),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=o("<div>"),this.$body.append(this.$elm),s=function(o,t){t.elm.remove()},this.showSpinner(),e.trigger(o.kfModal.AJAX_SEND),o.get(l).done(function(i){t&&(e.trigger(o.kfModal.AJAX_SUCCESS),t.$elm.empty().append(i).on(o.kfModal.CLOSE,s),t.hideSpinner(),t.open(),e.trigger(o.kfModal.AJAX_COMPLETE))}).fail(function(){e.trigger(o.kfModal.AJAX_FAIL),t.hideSpinner(),e.trigger(o.kfModal.AJAX_COMPLETE)});else this.$elm=e,this.$body.append(this.$elm),this.open()},o.kfModal.prototype={constructor:o.kfModal,open:function(){var t=this;this.options.doFade?(this.block(),setTimeout(function(){t.show()},this.options.fadeDuration*this.options.fadeDelay)):(this.block(),this.show()),this.options.escapeClose&&o(document).on("keydown.kfModal",function(t){27==t.which&&o.kfModal.close()}),this.options.clickClose&&this.blocker.click(function(t){t.target==this&&o.kfModal.close()})},close:function(){this.unblock(),this.hide(),o(document).off("keydown.kfModal")},block:function(){this.$elm.trigger(o.kfModal.BEFORE_BLOCK,[this._ctx()]),this.blocker=o('<div class="jquery-kfModal blocker"></div>'),this.$body.css("overflow","hidden"),this.$body.append(this.blocker),this.options.doFade&&this.blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(o.kfModal.BLOCK,[this._ctx()])},unblock:function(){if(this.options.doFade){var o=this;this.blocker.fadeOut(this.options.fadeDuration,function(){o.blocker.children().appendTo(o.$body),o.blocker.remove(),o.$body.css("overflow","")})}else this.blocker.children().appendTo(this.$body),this.blocker.remove(),this.$body.css("overflow","")},show:function(){this.$elm.trigger(o.kfModal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=o('<a href="#close-kfModal" rel="kfModal:close" class="close-kfModal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.kfModalClass+" current"),this.$elm.appendTo(this.blocker),this.options.doFade?this.$elm.css("opacity",0).animate({opacity:1},this.options.fadeDuration):this.$elm.show(),this.$elm.trigger(o.kfModal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(o.kfModal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove(),this.$elm.removeClass("current");var t=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){t.$elm.trigger(o.kfModal.AFTER_CLOSE,[t._ctx()])}):this.$elm.hide(0,function(){t.$elm.trigger(o.kfModal.AFTER_CLOSE,[t._ctx()])}),this.$elm.trigger(o.kfModal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||o('<div class="'+this.options.kfModalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,blocker:this.blocker,options:this.options}}},o.kfModal.close=function(o){if(t){o&&o.preventDefault(),t.close();var e=t.$elm;return t=null,e}},o.kfModal.isActive=function(){return t?!0:!1},o.kfModal.defaults={escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",kfModalClass:"kfModal",spinnerHtml:null,showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},o.kfModal.BEFORE_BLOCK="kfModal:before-block",o.kfModal.BLOCK="kfModal:block",o.kfModal.BEFORE_OPEN="kfModal:before-open",o.kfModal.OPEN="kfModal:open",o.kfModal.BEFORE_CLOSE="kfModal:before-close",o.kfModal.CLOSE="kfModal:close",o.kfModal.AFTER_CLOSE="kfModal:after-close",o.kfModal.AJAX_SEND="kfModal:ajax:send",o.kfModal.AJAX_SUCCESS="kfModal:ajax:success",o.kfModal.AJAX_FAIL="kfModal:ajax:fail",o.kfModal.AJAX_COMPLETE="kfModal:ajax:complete",o.fn.kfModal=function(e){return 1===this.length&&(t=new o.kfModal(this,e)),this},o(document).on("click.kfModal",'a[rel="kfModal:close"]',o.kfModal.close),o(document).on("click.kfModal",'a[rel="kfModal:open"]',function(t){t.preventDefault(),o(this).kfModal()})}(jQuery);